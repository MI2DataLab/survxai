<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to compare models with survxai â€¢ survxai</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Custom_predict_for_survival_models.html">Custom predict function for survival models</a>
    </li>
    <li>
      <a href="../articles/Global_explanations.html">Survival models - global explanations</a>
    </li>
    <li>
      <a href="../articles/How_to_compare_models_with_survxai.html">How to compare models with survxai</a>
    </li>
    <li>
      <a href="../articles/Local_explanations.html">Survival models - local explanations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>How to compare models with survxai</h1>
                        <h4 class="author">Alicja Gosiewska, Aleksandra Grudziaz</h4>
            
            <h4 class="date">2018-08-20</h4>
      
      
      <div class="hidden name"><code>How_to_compare_models_with_survxai.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Package <em>survxai</em> contains functions for creating a unified representation of a survival models. Such representations can be further processed by various survival explainers. Tools implemented in <em>survxai</em> help to understand how input variables are used in the model and what impact do they have on final model prediction.</p>
<p>The analyses carried out using this package can be divided into two parts: local analyses of new observations and global analyses showing the structures of survival models. In this vignette we present both, global and local explanations.</p>
<p>Methods and functions in <em>survxai</em> package are based on <a href="https://github.com/pbiecek/DALEX"><em>DALEX</em> package</a>.</p>
</div>
<div id="use-case---data" class="section level1">
<h1 class="hasAnchor">
<a href="#use-case---data" class="anchor"></a>Use case - data</h1>
<div id="data-set" class="section level2">
<h2 class="hasAnchor">
<a href="#data-set" class="anchor"></a>Data set</h2>
<p>We use the data from the Mayo Clinic trial in primary biliary cirrhosis (PBC) of the liver conducted between 1974 and 1984. A total of 424 PBC patients, referred to Mayo Clinic during that ten-year interval, met eligibility criteria for the randomized placebo controlled trial of the drug D-penicillamine. First 312 cases in the data set participated in the randomized trial and contain largely complete data. The <code>pbc</code> data is included in the <a href="https://CRAN.R-project.org/package=randomForestSRC"><em>randomForestSRC</em> package</a>.</p>
<p>We base models on three variables from <code>pbc</code> data set. They are <code>stage</code>, <code>sex</code>, and <code>bili</code>. For this purpouse we create a new data set <code>pbc_smaller</code>. We also change <code>days</code> for <code>years</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(pbc, <span class="dt">package =</span> <span class="st">"randomForestSRC"</span>)
pbc &lt;-<span class="st"> </span>pbc[<span class="kw">complete.cases</span>(pbc),]
pbc_smaller &lt;-<span class="st"> </span>pbc[,<span class="kw">c</span>(<span class="st">"days"</span>, <span class="st">"status"</span>,<span class="st">"sex"</span>, <span class="st">"bili"</span>, <span class="st">"stage"</span>)]
pbc_smaller<span class="op">$</span>years &lt;-<span class="st"> </span>pbc<span class="op">$</span>days<span class="op">/</span><span class="dv">365</span>
pbc_smaller &lt;-<span class="st"> </span>pbc_smaller[,<span class="op">-</span><span class="dv">1</span>]
<span class="kw">head</span>(pbc_smaller)</code></pre></div>
<pre><code>##   status sex bili stage     years
## 1      1   1 14.5     4  1.095890
## 2      0   1  1.1     3 12.328767
## 3      1   0  1.4     4  2.772603
## 4      1   1  1.8     4  5.273973
## 5      0   1  3.4     3  4.120548
## 7      0   1  1.0     3  5.019178</code></pre>
<p>We also convert variables <code>sex</code> and <code>stage</code> to factors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbc_smaller<span class="op">$</span>sex &lt;-<span class="st"> </span><span class="kw">as.factor</span>(pbc_smaller<span class="op">$</span>sex)
pbc_smaller<span class="op">$</span>stage &lt;-<span class="st"> </span><span class="kw">as.factor</span>(pbc_smaller<span class="op">$</span>stage)</code></pre></div>
<p>We divide our data set into train and test sets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">smp_size &lt;-<span class="st"> </span><span class="kw">floor</span>(<span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">nrow</span>(pbc_smaller))
<span class="kw">set.seed</span>(<span class="dv">123</span>)
train_ind &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(pbc_smaller)), <span class="dt">size =</span> smp_size)

train &lt;-<span class="st"> </span>pbc_smaller[train_ind, ]
test &lt;-<span class="st"> </span>pbc_smaller[<span class="op">-</span>train_ind, ]</code></pre></div>
</div>
<div id="models" class="section level2">
<h2 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h2>
<p>In this section, we create 3 models: Cox Proportional Hazards Model, Random Forests for Survival, and Parametric Survival Regression Model.</p>
<div id="cox-proportional-hazards-model" class="section level3">
<h3 class="hasAnchor">
<a href="#cox-proportional-hazards-model" class="anchor"></a>Cox Proportional Hazards Model</h3>
<p>Cox proportional hazards model is based on five variables: <code>age</code>, <code>treatment</code>, <code>stage</code>, <code>sex</code>, and <code>bili</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rms)

cph_model &lt;-<span class="st"> </span><span class="kw">cph</span>(<span class="kw">Surv</span>(years, status)<span class="op">~</span>., <span class="dt">data =</span> train, <span class="dt">surv =</span> <span class="ot">TRUE</span>, <span class="dt">x =</span> <span class="ot">TRUE</span>, <span class="dt">y=</span><span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="random-forests-for-survival" class="section level3">
<h3 class="hasAnchor">
<a href="#random-forests-for-survival" class="anchor"></a>Random Forests for Survival</h3>
<p>Random Forests for Survival is based on five variables: <code>age</code>, <code>treatment</code>, <code>stage</code>, <code>sex</code>, and <code>bili</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(randomForestSRC)
<span class="kw">set.seed</span>(<span class="dv">1994</span>)
rf_model &lt;-<span class="st"> </span><span class="kw">rfsrc</span>(<span class="kw">Surv</span>(years, status)<span class="op">~</span>., <span class="dt">data =</span> train)</code></pre></div>
</div>
<div id="parametric-survival-regression-model" class="section level3">
<h3 class="hasAnchor">
<a href="#parametric-survival-regression-model" class="anchor"></a>Parametric Survival Regression Model</h3>
<p>Parametric Survival Regression Model is based on five variables: <code>age</code>, <code>treatment</code>, <code>stage</code>, <code>sex</code>, and <code>bili</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survival)
reg_model &lt;-<span class="st"> </span><span class="kw">survreg</span>(<span class="kw">Surv</span>(years, status)<span class="op">~</span>., <span class="dt">data =</span> train, <span class="dt">x =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
</div>
</div>
<div id="explanation" class="section level1">
<h1 class="hasAnchor">
<a href="#explanation" class="anchor"></a>Explanation</h1>
<p>First, we have to create survival explainers - objects that wrap-up the black-box model with meta-data. Explainers unify model interfacing.</p>
<p>Some models require custom predict function. Examples are in <a href="https://mi2datalab.github.io/survxai/articles/Custom_predict_for_survival_models.html">Custom predict function for survival models vignette</a>.</p>
<p>Predict functions for <code>cph</code> and <code>rfsrc</code> objects are implemented.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survxai)

surve_cph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">model =</span> cph_model,
                     <span class="dt">data =</span> test[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)], 
                     <span class="dt">y =</span> <span class="kw">Surv</span>(test<span class="op">$</span>years, test<span class="op">$</span>status))

<span class="kw">print</span>(surve_cph)</code></pre></div>
<pre><code>## Model label:  coxph 
## Model class:  cph,rms,coxph 
## Data head  :
##   sex bili stage
## 2   1  1.1     3
## 3   0  1.4     4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">surve_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">model =</span> rf_model, 
                     <span class="dt">label =</span> <span class="st">"random forest"</span>,
                     <span class="dt">data =</span> test[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)], 
                     <span class="dt">y =</span> <span class="kw">Surv</span>(test<span class="op">$</span>years, test<span class="op">$</span>status))

<span class="kw">print</span>(surve_rf)</code></pre></div>
<pre><code>## Model label:  random forest 
## Model class:  rfsrc,grow,surv 
## Data head  :
##   sex bili stage
## 2   1  1.1     3
## 3   0  1.4     4</code></pre>
<p>For model created by <code>survreg()</code> function we have to add specific custom predict function. We add this function to explainer by <code>predict_function</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(CFC)

custom_predict &lt;-<span class="st"> </span><span class="cf">function</span>(model, newdata, times){
  times &lt;-<span class="st"> </span><span class="kw">sort</span>(times)
  vars &lt;-<span class="st"> </span><span class="kw">all.vars</span>(model<span class="op">$</span>call[[<span class="dv">2</span>]][[<span class="dv">2</span>]])
  n_vars &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colnames</span>(newdata) <span class="op">%in%</span><span class="st"> </span>vars)
  <span class="cf">if</span>(<span class="kw">length</span>(n_vars)<span class="op">&gt;</span><span class="dv">0</span>){
    newdata &lt;-<span class="st"> </span>newdata[,<span class="op">-</span><span class="kw">c</span>(n_vars)]
  }
  model<span class="op">$</span>x &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span>., newdata)
  res &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="kw">length</span>(times), <span class="dt">nrow =</span> <span class="kw">nrow</span>(newdata))
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(newdata)) {
    res[i,] &lt;-<span class="st"> </span><span class="kw">cfc.survreg.survprob</span>(<span class="dt">t =</span> times, <span class="dt">args =</span> model, <span class="dt">n =</span> i)    
  }
  <span class="kw">return</span>(res)
}

surve_reg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">model =</span> reg_model,
                     <span class="dt">data =</span> test[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)], 
                     <span class="dt">y =</span> <span class="kw">Surv</span>(test<span class="op">$</span>years, test<span class="op">$</span>status),
                     <span class="dt">predict_function =</span> custom_predict)
<span class="kw">print</span>(surve_reg)</code></pre></div>
<pre><code>## Model label:  survreg 
## Model class:  survreg 
## Data head  :
##   sex bili stage
## 2   1  1.1     3
## 3   0  1.4     4</code></pre>
<div id="global-explanations" class="section level2">
<h2 class="hasAnchor">
<a href="#global-explanations" class="anchor"></a>Global explanations</h2>
<p>At the beginning, we are dealing with global explanations. We focus on explanations of the global and conditional model structure.</p>
<div id="model-performance" class="section level3">
<h3 class="hasAnchor">
<a href="#model-performance" class="anchor"></a>Model performance</h3>
<p>Currently, in the <em>survxai</em> package is implemented only the <code>BS</code> type of model performance. In this metod for each time point we compute the prediction error for model. We compute <code>model_performance</code> explainers for all three models created above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mp_cph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_performance.html">model_performance</a></span>(surve_cph)
mp_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_performance.html">model_performance</a></span>(surve_rf)
mp_reg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_performance.html">model_performance</a></span>(surve_reg)</code></pre></div>
<p>For each explainer we can print values using generic <code>print()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(mp_cph)</code></pre></div>
<pre><code>## Model performance for Brier Score method.
##         time prediction error
## 1  0.1397260          ~ 0.75%
## 2  0.1945205          ~ 1.43%
## 3  0.3589041          ~ 2.28%
## 4  0.3835616          ~ 2.99%
## 5  0.5232877          ~ 3.96%
## 6  0.5424658          ~ 4.67%
## 7  0.5917808          ~ 4.24%
## 8  0.6109589          ~ 4.86%
## 9  0.8931507          ~ 5.69%
## 10 1.2602740           ~ 6.6%</code></pre>
<p>We plot all three models using generic <code>plot()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(mp_cph, mp_rf, mp_reg) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.30</span>))</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>On the plot, we see that the Cox Proportional Hazards Model and Parametric Survival Regression Model have simmilar performance - prediction errors for these models are almost the same. For the Survival Random Forest Model we have the smallest prediction errors.</p>
</div>
<div id="variable-response" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-response" class="anchor"></a>Variable response</h3>
<p>Variable response explainers are designed to better understand the relation between a variable and a model output. We compute <code>variable_response</code> explainers for all three models created above.</p>
<div id="factor-variable" class="section level4">
<h4 class="hasAnchor">
<a href="#factor-variable" class="anchor"></a>Factor variable</h4>
<p>First, we compute explainers for the factor variable <code>sex</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vr_cph_sex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_response.html">variable_response</a></span>(surve_cph, <span class="st">"sex"</span>)
vr_rf_sex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_response.html">variable_response</a></span>(surve_rf, <span class="st">"sex"</span>)
vr_reg_sex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_response.html">variable_response</a></span>(surve_reg, <span class="st">"sex"</span>)</code></pre></div>
<p>For each explainer we can print values using generic <code>print()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(vr_cph_sex)</code></pre></div>
<pre><code>##           x         y value type label var
## 1 0.1397260 0.9922858     1  pdp coxph sex
## 2 0.1945205 0.9922858     1  pdp coxph sex
## 3 0.3589041 0.9762765     1  pdp coxph sex
## 4 0.3835616 0.9762765     1  pdp coxph sex
## 5 0.5232877 0.9613915     1  pdp coxph sex
## 6 0.5424658 0.9613915     1  pdp coxph sex</code></pre>
<p>We visualize explainers on one plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(vr_cph_sex, vr_rf_sex, vr_reg_sex)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>We see that in all models patients with <code>sex=1</code> have higher probability of survival.</p>
<p>In <code>survival_variable_response</code> plots we can also compare models in division into all variable levels using parameter <code>split = "variable"</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(vr_cph_sex, vr_rf_sex, vr_reg_sex, <span class="dt">split =</span> <span class="st">"variable"</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="continuous-variable" class="section level4">
<h4 class="hasAnchor">
<a href="#continuous-variable" class="anchor"></a>Continuous variable</h4>
<p>We can also compute the <code>pdp</code> plots for numeric variables. For this, we divide values of variable <code>bili</code> into 6 intervals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vr_cph_bili &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_response.html">variable_response</a></span>(surve_cph, <span class="st">"bili"</span>)
vr_rf_bili &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_response.html">variable_response</a></span>(surve_rf, <span class="st">"bili"</span>)
vr_reg_bili &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable_response.html">variable_response</a></span>(surve_reg, <span class="st">"bili"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(vr_cph_bili, vr_rf_bili, vr_reg_bili)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>As mentioned above we can split our comparison by each variable level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(vr_cph_bili, vr_rf_bili, vr_reg_bili, <span class="dt">split =</span> <span class="st">"variable"</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
</div>
</div>
<div id="local-explanations" class="section level2">
<h2 class="hasAnchor">
<a href="#local-explanations" class="anchor"></a>Local explanations</h2>
<p>The next aspects of survival model analysis are local explanations - the explanations for one, new observation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">single_observation &lt;-<span class="st"> </span>test[<span class="dv">1</span>,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)]
single_observation</code></pre></div>
<pre><code>##   sex bili stage
## 2   1  1.1     3</code></pre>
<div id="ceteris-paribus" class="section level3">
<h3 class="hasAnchor">
<a href="#ceteris-paribus" class="anchor"></a>Ceteris paribus</h3>
<p>Ceteris Paribus Plots for survival models are survival curves around one observation. Each curve represent observation with different value of chosen variable. For factor variables curves covers all possible values, for numeric variables values are divided into quantiles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cp_cph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(surve_cph, single_observation)
cp_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(surve_rf, single_observation)
cp_reg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(surve_reg, single_observation)</code></pre></div>
<p>For each ceteris paribus explainer we can print values using generic <code>print()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(cp_cph)</code></pre></div>
<pre><code>##       y_hat new_x vname x_quant quant relative_quant label      time
## 1 0.9978522     0   sex       0     0              0 coxph 0.1397260
## 2 0.9978522     0   sex       0     0              0 coxph 0.1945205
## 3 0.9927118     0   sex       0     0              0 coxph 0.3589041
## 4 0.9927118     0   sex       0     0              0 coxph 0.3835616
## 5 0.9870411     0   sex       0     0              0 coxph 0.5232877
## 6 0.9870411     0   sex       0     0              0 coxph 0.5424658
##    class
## 1 factor
## 2 factor
## 3 factor
## 4 factor
## 5 factor
## 6 factor</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cp_cph, <span class="dt">scale_type =</span> <span class="st">"gradient"</span>, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>))</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cp_rf, <span class="dt">scale_type =</span> <span class="st">"gradient"</span>, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>))</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-20-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cp_reg, <span class="dt">scale_type =</span> <span class="st">"gradient"</span>, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>))</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-20-3.png" width="700"></p>
<p>On the plots above we see that for variables <code>bili</code> and <code>sex</code> <code>coxph</code> and <code>survreg</code> model have simmilar performance, but <code>randomForest</code> model has different predictions of survival probability.</p>
</div>
<div id="prediction-breakdown" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-breakdown" class="anchor"></a>Prediction breakdown</h3>
<p>Break Down Plots for survival models compare, by default, differences in predictions for median of time. We can change the time of computing the contributions for each variable using <code>time</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">broken_prediction_cph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prediction_breakdown.html">prediction_breakdown</a></span>(surve_cph, single_observation)
broken_prediction_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prediction_breakdown.html">prediction_breakdown</a></span>(surve_rf, single_observation)
broken_prediction_reg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prediction_breakdown.html">prediction_breakdown</a></span>(surve_reg, single_observation)</code></pre></div>
<p>For each prediction breakdown explainer we can print values using generic <code>print()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(broken_prediction_cph)</code></pre></div>
<pre><code>##       contribution
## bili       10.103%
## stage       7.714%
## sex         1.069%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(broken_prediction_cph, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lines_type =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(broken_prediction_rf, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lines_type =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-23-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(broken_prediction_reg, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lines_type =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-23-3.png" width="700"></p>
<p>This plots helps to understand the factors that drive survival probability for a single observation.</p>
<p>For all models variable <code>bili</code> is the variable with the largest contribution. But the second variable is different randomForest (<code>age</code>) and coxph, survreg (<code>stage</code>).</p>
<p>We can also compute the variables contribution for chosen survival probability value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">broken_prediction_cph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prediction_breakdown.html">prediction_breakdown</a></span>(surve_cph, single_observation, <span class="dt">prob =</span> <span class="fl">0.8</span>)
broken_prediction_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prediction_breakdown.html">prediction_breakdown</a></span>(surve_rf, single_observation, <span class="dt">prob =</span> <span class="fl">0.8</span>)
broken_prediction_reg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prediction_breakdown.html">prediction_breakdown</a></span>(surve_reg, single_observation, <span class="dt">prob =</span> <span class="fl">0.8</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(broken_prediction_cph, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lines_type =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(broken_prediction_rf, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lines_type =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-25-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(broken_prediction_reg, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lines_type =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-25-3.png" width="700"></p>
<p>We can compare this models on one plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(broken_prediction_cph, broken_prediction_rf, broken_prediction_reg, <span class="dt">scale_col =</span> <span class="kw">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lines_type =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="How_to_compare_models_with_survxai_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>For the transparency of the charts we recommend drawning them separately.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#use-case---data">Use case - data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data-set">Data set</a></li>
      <li><a href="#models">Models</a></li>
      </ul>
</li>
      <li>
<a href="#explanation">Explanation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#global-explanations">Global explanations</a></li>
      <li><a href="#local-explanations">Local explanations</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Aleksandra Grudziaz, Alicja Gosiewska, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
